var kpfLayerCounter=0,eventOverallDuration=0,KPFPlaybackController=Class.create({initialize:function(e,t){this.domNode=t,this.kpfEvent=null},destroy:function(){this.removeEvent(),this.domNode=null},removeEvent:function(){if(this.kpfEvent){this.kpfEvent.destroy(),delete this.kpfEvent,this.kpfEvent=null;while(this.domNode.childNodes.length>0)this.domNode.removeChild(this.domNode.childNodes[0])}},renderEvent:function(e){this.removeEvent(),this.kpfEvent=e,this.kpfEvent.renderEvent(this.domNode)},renderEffects:function(){var e=this.kpfEvent.renderEffects(this.kpfEvent.event.effects);return e},animateEffects:function(e){this.kpfEvent.animateEffects(e)},eventOverallEndTime:function(){return this.kpfEvent.eventOverallEndTime}}),KPFEvent=Class.create({initialize:function(e){this.slideId=e.slideId,this.slideIndex=e.slideIndex,this.sceneIndex=e.sceneIndex,this.animationSupported=e.animationSupported,this.event=e.event,this.baseLayer={},this.effects=[],this.cssRenderer={},this.eventOverallEndTime=0,this.overallEndTimeInternal()},destroy:function(){this.baseLayer.destroy(),this.cssRenderer.destroy();for(var e=0,t=this.effects.length;e<t;e++)this.effects[e].destroy();delete this.baseLayer,delete this.cssRenderer,delete this.effects,delete this.event,this.slideId=null,this.slideIndex=null,this.sceneIndex=null,this.animationSupported=null,this.eventOverallEndTime=null},addAnimationsToIdenticalLayer:function(e,t){if(e.animations&&e.animations.length>0)for(var n=0,r=e.animations.length;n<r;n++)t.animations.push(e.animations[n]);if(e.layers&&e.layers.length>0)for(var i=0,s=e.layers.length;i<s;i++)this.addAnimationsToIdenticalLayer(e.layers[i],t.layers[i])},processEffects:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(r.type==="actionBuild"){var i=!1,s;for(var o=0,u=t.length;o<u;o++)if(t[o].type==="actionBuild"&&t[o].objectID===r.objectID){s=o,i=!0;break}if(i){this.addAnimationsToIdenticalLayer(r.baseLayer,t[s].baseLayer),r.beginTime<t[s].beginTime&&(t[s].beginTime=r.beginTime),r.beginTime+r.duration>t[s].beginTime+t[s].duration&&(t[s].duration=r.beginTime+r.duration);for(var a=0,f=r.effects.length;a<f;a++)t[s].effects.push(r.effects[a]);t[s].names==null&&(t[s].names=[]),t[s].names.push(r.name)}else t.push(r)}else t.push(r)}for(var n=0,u=t.length;n<u;n++)t[n].effects=this.processEffects(t[n].effects);return t},renderEffects:function(e){var t=[];for(var n=0,r=e.length;n<r;n++){var i=new KPFEffect(e[n],this.animationSupported),s=!1;this.cssRenderer.initRendererFlags(i);if(i.baseLayer==null)this.renderAudioOnlyEffect(i);else{if(i.type==="actionBuild")for(var o=0,u=this.effects.length;o<u;o++)this.effects[o].objectID===i.objectID&&(this.effects[o].type==="actionBuild"?s=!0:s=!1);if(this.baseLayer.objectID===i.objectID){var a=new KPFLayer(i.baseLayer,{animationSupported:this.animationSupported,name:i.name,type:i.type}),f=document.getElementById("layer"+this.baseLayer.layerId),l=f.parentNode,c=document.createElement("div");c.setAttribute("id","layer"+a.layerId),this.baseLayer=a,i.kpfLayer=a,this.cssRenderer.layer=a,this.cssRenderer.domNode=c,this.cssRenderer.draw(l),l.removeChild(f)}else this.renderEffect(this.baseLayer,i,s)}this.effects.push(i),t.push(i)}return t},renderEffect:function(e,t,n){var r;for(var i=0,s=e.layers.length;i<s;i++){if(e.layers[i].objectID===t.objectID){var o=new KPFLayer(t.baseLayer,{animationSupported:this.animationSupported,name:t.name,type:t.type},e.bounds.offset),u="layer"+e.layers[i].layerId,a=document.getElementById("layer"+e.layers[i].layerId),f=a.parentNode;t.kpfLayer=o;if(!n){e.layers[i]=o;var l=this.cssRenderer.createNodes(f,e,o);f.replaceChild(l,a)}else t.currentKPFLayer=e.layers[i];r=!0}else r=this.renderEffect(e.layers[i],t,n);if(r)break}return r},renderEvent:function(e){var t={animationSupported:this.animationSupported};this.event.effects&&this.event.effects.length===1&&(t.name=this.event.effects[0].name,t.type=this.event.effects[0].type,t.objectID=this.event.effects[0].objectID),this.baseLayer=new KPFLayer(this.event.baseLayer,t),this.cssRenderer=new KPFCssRenderer(this.baseLayer,this.sceneIndex,this.animationSupported,this.effects),this.cssRenderer.draw(e)},renderAudioOnlyEffect:function(e){if(e.name!="renderMovie")return;var t=e.movie;if(!t.isAudioOnly)return;gShowController.audioCache==null&&(gShowController.audioCache={});var n=t.asset+"-audio",r=gShowController.audioCache[n];if(r==null){var i=gShowController.textureManager.urlForAsset(t.asset,this.slideId);r=new Audio(i),t&&(t.loopMode&&t.loopMode==="looping"&&(r.loop=!0),t.volume&&(r.volume=t.volume)),gShowController.audioCache[n]=r}r.play()},animateEffects:function(e){for(var t=0,n=e.length;t<n;t++)this.animateEffect(e[t])},animateEffect:function(e){this.cssRenderer.animate(e),e.effects.length>0&&setTimeout(this.handleEffectDidComplete.bind(this,e),(e.beginTime+e.duration)*1e3)},handleEffectDidComplete:function(e){var t=this.renderEffects(e.effects);for(var n=0,r=t.length;n<r;n++)this.animateEffect(t[n])},overallEndTime:function(){return this.eventOverallEndTime},overallEndTimeInternal:function(){for(var e=0,t=this.event.effects.length;e<t;e++){var n=0,r=this.event.effects[e];this.calculateOverallEndTime(n,r)}},calculateOverallEndTime:function(e,t){var n=e+t.beginTime+t.duration;n>this.eventOverallEndTime&&(this.eventOverallEndTime=n);for(var r=0,i=t.effects.length;r<i;r++)this.calculateOverallEndTime(n,t.effects[r])}}),KPFEffect=Class.create({initialize:function(e,t){this.type=e.type,this.name=e.name,this.beginTime=e.beginTime,this.duration=e.duration,this.objectID=e.objectID,this.baseLayer=e.baseLayer,e.movie&&(this.movie=e.movie),this.effects=[],this.addSubEffect(e.effects,t)},destroy:function(){for(var e=0,t=this.effects.length;e<t;e++)this.destroyEffect(this.effects[e]);this.type=null,this.name=null,this.beginTime=null,this.duration=null,this.objectID=null,delete this.kpfLayer,delete this.effects,delete this.baseLayer,this.movie&&delete this.movie,this.currentKPFLayer&&delete this.currentKPFLayer},destroyEffect:function(e){for(var t=0,n=e.effects.length;t<n;t++)this.destroyEffect(e.effects[t]);e.type=null,e.name=null,e.beginTime=null,e.duration=null,e.objectID=null,delete e.kpfLayer,delete e.effects,delete e.baseLayer,e.movie&&delete e.movie,e.currentKPFLayer&&delete e.currentKPFLayer},addSubEffect:function(e,t){for(var n=0,r=e.length;n<r;n++){var i=new KPFEffect(e[n],t);this.effects.push(i)}}}),KPFCssRenderer=Class.create({initialize:function(e,t,n,r){this.textureId=e.textureId,this.nativeWidth=e.bounds.width,this.nativeHeight=e.bounds.height,this.opacity=e.opacity,this.visibility=e.hidden===!0?"hidden":"visible",this.textureTransform=e.textureTransform,this.affineTransform=e.affineTransform,this.anchorPoint=e.anchorPoint,this.contentsRect=e.contentsRect,this.layer=e,this.sceneIndex=t,this.animationSupported=n,this.enableCompositingUsingBackface=!1,this.enablePreserve3DFromParent=!1,r.length>0&&this.initRendererFlags(r[0]),this.domNode=document.createElement("div"),this.domNode.setAttribute("id","layer"+e.layerId)},initRendererFlags:function(e){e.type==="transition"&&e.name!="apple:ca-swing"&&e.name!="com.apple.iWork.Keynote.BLTSwoosh"?(this.enableCompositingUsingBackface=!0,this.enablePreserve3DFromParent=!0,isChrome&&(e.name==="apple:ca-push"||e.name==="com.apple.iWork.Keynote.BLTFadeThruColor")&&(this.enableCompositingUsingBackface=!1,this.enablePreserve3DFromParent=!1)):(this.enableCompositingUsingBackface=!1,this.enablePreserve3DFromParent=!1),e.name==="apple:apple-grid"?this.isGridTransition=!0:e.name==="com.apple.iWork.Keynote.BLTMosaicFlip"?this.isMosaicTransition=!0:e.name==="com.apple.iWork.Keynote.BLTSwoosh"&&e.type==="transition"&&(this.isSwooshTransition=!0)},destroy:function(){this.textureId=null,this.nativeWidth=null,this.nativeHeight=null,this.opacity=null,this.visibility=null,this.textureTransform=null,this.affineTransform=null,this.anchorPoint=null,this.textureAnimation=null,this.contentsRect=null,this.requiresPerspectiveTransform=null,this.sceneIndex=null;if(this.domNode.hasChildNodes())while(this.domNode.childNodes.length>0)this.domNode.removeChild(this.domNode.firstChild);this.domNode=null},addAnimationNode:function(e,t,n,r){if(t==null)return e;var i=t.shift();if(i==null)return e;var s=document.createElement("div"),o=n+"-"+escapeTextureId(i);return s.setAttribute("id",o),r.initialState.masksToBounds&&setElementProperty(s,"overflow","hidden"),isChrome&&(this.enableCompositingUsingBackface?setElementProperty(s,kBackfaceVisibilityPropertyName,"hidden"):this.isSwooshTransition&&setElementProperty(s,kTransformPropertyName,"translateZ(0px)")),this.setStyle(s,"0px","0px",e.style.width,e.style.height,kPositionAbsolutePropertyValue,null,null),setElementProperty(s,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue),(r.anchorPoint.pointX!=.5||r.anchorPoint.pointY!=.5)&&setElementProperty(s,kTransformOriginPropertyName,r.anchorPoint.pointX*100+"% "+r.anchorPoint.pointY*100+"%"),r.transformOriginZValue!=""&&i!="opacity"&&i!="doubleSided"&&i!="anchorPointZ"&&(Prototype.Browser.Gecko?setElementProperty(s,kTransformOriginPropertyName,r.anchorPoint.pointX*100+"% "+r.anchorPoint.pointY*100+"% "+r.transformOriginZValue+"px"):(setElementProperty(s,kTransformOriginZPropertyName,r.transformOriginZValue+"px"),navigator.userAgent.lastIndexOf("Chrome/")<=0&&setElementProperty(s,kTransformPropertyName,"translateZ("+r.transformOriginZValue+"px)"))),e.appendChild(s),this.addAnimationNode(s,t,n,r)},createNodes:function(e,t,n){var r=this.addNode(e,t,n);return r},addNode:function(e,t,n){var r="layer"+n.layerId,i=document.createElement("div");i.setAttribute("id",r),setElementProperty(i,"pointer-events","none");var s=n.contentsRect.x,o=n.contentsRect.y,u=n.contentsRect.width,a=n.contentsRect.height,f=n.affineTransform[0],l=n.affineTransform[1],c=n.affineTransform[2],h=n.affineTransform[3],p=n.affineTransform[4],d=n.affineTransform[5],v="matrix("+f+","+l+","+c+","+h+","+(p+n.bounds.offset.pointX)+","+(d+n.bounds.offset.pointY)+")";this.setStyle(i,"0px","0px",n.bounds.width+"px",n.bounds.height+"px",kPositionAbsolutePropertyValue,n.opacity,n.visibility),setElementProperty(i,kTransformPropertyName,v),(n.anchorPoint.pointX!=.5||n.anchorPoint.pointY!=.5)&&setElementProperty(i,kTransformOriginPropertyName,n.anchorPoint.pointX*100+"% "+n.anchorPoint.pointY*100+"%"),n.initialState.masksToBounds&&setElementProperty(i,"overflow","hidden"),e.appendChild(i);var m;this.animationSupported?m=this.addAnimationNode(i,n.divNames,r,n):m=i,n.isTransition&&this.enablePreserve3DFromParent?(t.sublayerTransform[11]!=0&&setElementProperty(i,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue),n.sublayerTransform[11]!=0&&(setElementProperty(i,kPerspectivePropertyName,gShowController.stageManager.perspective+"px"),setElementProperty(i,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue))):t.sublayerTransform[11]!=0?(setElementProperty(e,kPerspectivePropertyName,gShowController.stageManager.perspective+"px"),setElementProperty(i,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue)):setElementProperty(i,kTransformStylePropertyName,kTransformStyleFlatPropertyValue),isChrome&&(this.enableCompositingUsingBackface?setElementProperty(i,kBackfaceVisibilityPropertyName,"hidden"):this.isSwooshTransition&&setElementProperty(i,kTransformPropertyName,"translateZ(0px)"));var g=n.textureId;if(g){var y,b;if(n.hasContentsAnimation){var w=n.cssAnimation.animations;for(var E=0,S=w.length;E<S;E++)if(w[E].property==="contents"){g=w[E].to.texture,b=w[E].from.texture;break}}var y=this.cloneNode(gShowController.textureManager.getTextureObject(this.sceneIndex,g));y.setAttribute("id",g),browserPrefix==="webkit"&&n.isTransition==null&&setElementProperty(y,kTransformPropertyName,"translateZ(0px)");if(s===0&&o===0&&u===1&&a===1)this.setStyle(y,"0px","0px",n.bounds.width+"px",n.bounds.height+"px",kPositionAbsolutePropertyValue,null,null);else{var x,T;y.nodeName.toLowerCase()==="svg"?(x=y.getAttribute("width"),T=y.getAttribute("height")):(x=y.naturalWidth,T=y.naturalHeight,y.src.indexOf("KNTransitionSlide_Black.png")!=-1&&(x=gShowController.script.slideWidth,T=gShowController.script.slideHeight));var N=o*T,C=(s+u)*x,k=(o+a)*T,L=s*x;this.setStyle(y,-N+"px",-L+"px",x+"px",T+"px",kPositionAbsolutePropertyValue,null,null),setElementProperty(y,"clip","rect("+N+"px, "+C+"px, "+k+"px, "+L+"px)")}n.isTransition&&(isChrome?this.enableCompositingUsingBackface?!this.isGridTransition&&!this.isMosaicTransition&&setElementProperty(y,kBackfaceVisibilityPropertyName,"hidden"):this.isSwooshTransition&&setElementProperty(y,kTransformPropertyName,"translateZ(0px)"):this.enableCompositingUsingBackface?setElementProperty(y,kBackfaceVisibilityPropertyName,"hidden"):setElementProperty(y,kTransformPropertyName,"translateZ(0px)"));var A=gShowController.textureManager.getTextureInfo(this.sceneIndex,n.textureId),O;if(A.movie){gShowController.movieCache==null&&(gShowController.movieCache={});var M=t.objectID+"-video";n.hasMovie=!0,n.movieId=M,O=gShowController.movieCache[M],O==null&&(O=document.createElement("video"),setElementProperty(O,"pointer-events","all"),this.setStyle(O,"0px","0px",n.bounds.width+"px",n.bounds.height+"px",kPositionAbsolutePropertyValue,null,"hidden"),O.setAttribute("id",M),O.setAttribute("src",gShowController.textureManager.getMovieUrl(this.sceneIndex,n.textureId)),gShowController.isRecording===!1&&O.setAttribute("controls","controls"),Event.stopObserving(O,"play"),Event.stopObserving(O,"ended"),Event.observe(O,"play",this.handleMovieDidStart.bind(this,y,O)),Event.observe(O,"ended",this.handleMovieDidEnd.bind(this,y,O)),gShowController.movieCache[M]=O,n.animationInfo.type==="buildOut"&&(y.style.visibility="visible"),gShowController.movieCacheInfo==null&&(gShowController.movieCacheInfo={}),gShowController.movieCacheInfo[M]={objectID:t.objectID,previousSibling:m.previousSibling.childNodes[0].id})}else if(t.objectID&&gShowController.movieCacheInfo){var M=t.objectID+"-video",_=gShowController.movieCacheInfo[M];_&&n.textureId===_.previousSibling&&(O=gShowController.movieCache[M],n.animationInfo&&n.animationInfo.type==="buildOut"&&n.animationInfo.objectID===t.objectID&&delete gShowController.movieCacheInfo[M])}if(n.hasContentsAnimation){y.setAttribute("preserveAspectRatio","none");var D=document.createElement("div");D.id=r+"-contents-to",this.setStyle(D,y.style.top,y.style.left,y.style.width,y.style.height,kPositionAbsolutePropertyValue,null,null),D.appendChild(y),m.appendChild(D),setElementProperty(D,"opacity",0);var P=gShowController.textureManager.getTextureObject(this.sceneIndex,b).cloneNode(!0);P.setAttribute("id",b),this.setStyle(P,"0px","0px",n.bounds.width+"px",n.bounds.height+"px",kPositionAbsolutePropertyValue,null,null),setElementProperty(P,kBackfaceVisibilityPropertyName,"hidden");var H=document.createElement("div");H.id=r+"-contents-from",this.setStyle(H,P.style.top,P.style.left,P.style.width,P.style.height,kPositionAbsolutePropertyValue,null,null),H.appendChild(P),m.appendChild(H)}else m.appendChild(y);O&&(m.appendChild(O),O.isPlaying&&(y.style.visibility="hidden",n.animationInfo&&(n.animationInfo.objectID===t.objectID?!O.isEnded&&n.animationInfo.type!="buildOut"&&O.play():O.isEnded||O.play())))}else if(n.initialState.backgroundColor){var B=n.initialState.backgroundColor;setElementProperty(m,"background-color","rgba("+parseInt(B[0]*255)+","+parseInt(B[1]*255)+","+parseInt(B[2]*255)+","+B[3]+")")}for(var j=0,F=n.layers.length;j<F;j++)this.addNode(m,n,n.layers[j]);return i},cloneNode:function(e){var t=e.cloneNode(!0);if(browserPrefix==="ms"&&browserVersion>=10){var n=e.getElementsByTagName("feGaussianBlur");if(n){var r=t.getElementsByTagName("feGaussianBlur");for(var i=0,s=n.length;i<s;i++)r[i].setAttribute("stdDeviation",n[i].getAttribute("stdDeviation"))}}return t},serializeSvg:function(e){var t=e.getElementsByTagName("image");for(var n=0,r=t.length;n<r;n++){var i=t[n],s=document.createElement("a");s.href=i.getAttributeNS("http://www.w3.org/1999/xlink","href");var o=window.location.protocol+"//"+s.host+s.pathname;i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o)}var u=new XMLSerializer,a=u.serializeToString(e);return a},draw:function(e){this.setStyle(this.domNode,"0px","0px",this.nativeWidth+"px",this.nativeHeight+"px",kPositionAbsolutePropertyValue,this.opacity,this.visibility),browserPrefix==="webkit"&&(this.enableCompositingUsingBackface&&isChrome?setElementProperty(this.domNode,kBackfaceVisibilityPropertyName,"hidden"):setElementProperty(this.domNode,kTransformPropertyName,"translateZ(0px)")),this.layer.sublayerTransform[11]!=0?(setElementProperty(this.domNode,kPerspectivePropertyName,gShowController.stageManager.perspective+"px"),setElementProperty(this.domNode,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue)):setElementProperty(this.domNode,kTransformStylePropertyName,kTransformStyleFlatPropertyValue);for(var t=0,n=this.layer.layers.length;t<n;t++)this.createNodes(this.domNode,this.layer,this.layer.layers[t]);e.appendChild(this.domNode)},setStyle:function(e,t,n,r,i,s,o,u){e.style.top=t,e.style.left=n,e.style.width=r,e.style.height=i,e.style.position=s,o!=null&&o!=undefined&&(e.style.opacity=o),u!=null&&u!=undefined&&(e.style.visibility=u)},overallEndTime:function(e){var t={};return t.duration=0,this.overallEndTimeForLayer(this.layer,t),t.duration},overallEndTimeForLayer:function(e,t){e.cssAnimation&&e.cssAnimation.overallEndTime>t.duration&&(t.duration=e.cssAnimation.overallEndTime);for(var n=0,r=e.layers.length;n<r;n++)this.overallEndTimeForLayer(e.layers[n],t)},animate:function(e){this.animationSupported&&e.kpfLayer&&(e.movie?this.animateEffect(e,e.kpfLayer,e.currentKPFLayer?e.currentKPFLayer:null,e.movie):this.animateEffect(e,e.kpfLayer,e.currentKPFLayer?e.currentKPFLayer:null))},animateEffect:function(e,t,n,r){if(t.cssAnimationRules.length>0){var i=n?"layer"+n.layerId:"layer"+t.layerId,s=document.getElementById(i);s&&this.applyCssAnimation(s,t,n)}else{if(t.hasMovie&&t.animationInfo.name==="renderMovie"){var o=document.getElementById(t.movieId);r&&(r.loopMode&&r.loopMode==="looping"&&(o.loop=!0),r.volume&&(o.volume=r.volume)),this.startMovie(o)}if(n){var u=document.getElementById("layer"+n.layerId),a=window.getComputedStyle(u,null),f=a.getPropertyValue(kTransformPropertyName),l=parseTransformMatrix(f),c="matrix("+l[0]+","+l[1]+","+l[2]+","+l[3]+","+t.bounds.offset.pointX+","+t.bounds.offset.pointY+")";e.name==="apple:action-motion-path"&&setElementProperty(u,kTransformPropertyName,c)}}for(var h=0,p=t.layers.length;h<p;h++)this.animateEffect(e,t.layers[h],n?n.layers[h]:null,r)},applyCssAnimation:function(e,t,n){var r=t.cssAnimation,i=t.cssAnimationRules,s=t.cssAnimation.overallEndTime;t.hasMovie&&t.animationInfo.type==="buildOut"&&this.stopMovie(document.getElementById(t.movieId)),isChrome&&t.animationInfo.name==="apple:doorway"&&t.layers.length===0&&t.contentsRect.x===0&&t.contentsRect.y===0&&t.contentsRect.width===1&&t.contentsRect.height===1&&(e.style.visibility="hidden");for(var o in r.keyAnimations){if(o!="bounds")continue;var u=r.keyAnimations[o],a=document.styleSheets[1].cssRules;for(var f=0,l=a.length;f<l;f++){var c=a[f],h=e.id+"-"+o;if(c.name===h){while(c.cssRules.length>0)if(browserPrefix==="ms")for(var p=0,d=c.cssRules.length;p<d;p++)c.deleteRule(p);else c.deleteRule(c.cssRules[0].keyText);for(var p=0,v=u.keyframes.length;p<v;p++){var m=u.keyframes[p];if(o==="bounds"){var g,y,b,w;m.keyframe==0?(g=m.value.width,y=m.value.height,c.insertRule?c.insertRule("0% {"+kTransformPropertyName+": scaleX(1) scaleY(1); "+kAnimationTimingFunctionPropertyName+": "+m.timingFunction+";}"):c.appendRule("0% {"+kTransformPropertyName+": scaleX(1) scaleY(1); "+kAnimationTimingFunctionPropertyName+": "+m.timingFunction+";}")):(b=m.value.width,w=m.value.height,c.insertRule?c.insertRule(m.keyframe+"% {"+kTransformPropertyName+": scaleX("+b/g+") scaleY("+w/y+"); "+kAnimationTimingFunctionPropertyName+": "+m.timingFunction+";}"):c.appendRule(m.keyframe+"% {"+kTransformPropertyName+": scaleX("+b/g+") scaleY("+w/y+"); "+kAnimationTimingFunctionPropertyName+": "+m.timingFunction+";}"))}}}}}if(t.initialState.rotation!==0||t.initialState.scale!==1){var E=document.getElementById(e.id),S=window.getComputedStyle(E,null),x=S.getPropertyValue(kTransformPropertyName),T=parseTransformMatrix(x),N="matrix(1,0,0,1,"+T[4]+","+T[5]+")";setElementProperty(E,kTransformPropertyName,N);var C=document.getElementById(e.id+"-"+escapeTextureId("transform.rotation.z"));C&&setElementProperty(C,kTransformPropertyName,"rotateZ("+t.initialState.rotation+"rad)");var k=document.getElementById(e.id+"-"+escapeTextureId("transform.scale.x"));k&&setElementProperty(k,kTransformPropertyName,"scaleX("+t.initialState.scale+")");var L=document.getElementById(e.id+"-"+escapeTextureId("transform.scale.y"));L&&setElementProperty(L,kTransformPropertyName,"scaleY("+t.initialState.scale+")")}for(var o in r.keyAnimations){var u=r.keyAnimations[o],A=u.keyActions,O=A[A.length-1],M=u.keyframes[u.keyframes.length-1],_=this.cssPropertyNameForAction(o),D=this.cssPropertyValueForActionValue(o,M.value),P=s+"s",h="",H="";if(o==="isPlaying")continue;if(o==="doubleSided"){var B=document.getElementById(e.id+"-"+escapeTextureId(o));B&&setElementProperty(B,_,D);continue}switch(o){case"opacity":h=e.id+"-opacity",H=h,n?(document.getElementById(h)==null&&(h=e.id),H="layer"+t.layerId+"-opacity"):setElementProperty(e,"opacity",1);break;case"hidden":_="opacity",D==="hidden"?D=0:(e.style.visibility="visible",D=1),h=e.id,H=h+"-hidden",n&&(H="layer"+t.layerId+"-hidden");break;case"bounds":h=e.id+"-bounds",H=h,n&&(H="layer"+t.layerId+"-bounds");var g,y,j,F,I=u.keyframes[0],q=u.keyframes[u.keyframes.length-1];D="scaleX("+q.value.width/I.value.width+") scaleY("+q.value.height/I.value.height+")";break;default:h=e.id+"-"+escapeTextureId(o),H=h,n&&(H="layer"+t.layerId+"-"+escapeTextureId(o))}if(o==="contents"){var R=e.id+"-contents-from",U=e.id+"-contents-to",z=R,W=U;n&&(z="layer"+t.layerId+"-contents-from",W="layer"+t.layerId+"-contents-to");var X=document.getElementById(R),V=document.getElementById(U);setElementProperty(X,"opacity",0),setElementProperty(X,kAnimationNamePropertyName,z),setElementProperty(X,kAnimationDurationPropertyName,P),setElementProperty(V,"opacity",1),setElementProperty(V,kAnimationNamePropertyName,W),setElementProperty(V,kAnimationDurationPropertyName,P);continue}var $=document.getElementById(h);if($){if(o==="anchorPoint"){var J={};J.x=O.to.pointX,J.y=O.to.pointY;var K={},Q={},G={};Q.x=t.bounds.width/2,Q.y=t.bounds.height/2,J.x!=null&&J.y!=null&&(G.x=J.x*t.bounds.width,G.y=J.y*t.bounds.height,K.x=Q.x-G.x,K.y=Q.y-G.y,t.magicMoveOffsetValue&&(K.x=t.magicMoveOffsetValue.pointX,K.y=t.magicMoveOffsetValue.pointY),_=kTransformPropertyName,D="translateX("+K.x+"px) translateY("+K.y+"px)")}else o==="anchorPointZ"&&(Prototype.Browser.Gecko||navigator.userAgent.lastIndexOf("Chrome/")>0?(_=kTransformPropertyName,D="translateZ("+ -t.transformOriginZValue+"px)"):(_=kTransformPropertyName,D="translateZ("+t.transformOriginZValue+"px)"));o==="hidden"?setElementProperty($,kAnimationFillModePropertyName,O.fillMode==="removed"?"none":O.fillMode):(setElementProperty($,_,D),n&&setElementProperty($,kAnimationFillModePropertyName,O.fillMode==="removed"?"none":O.fillMode)),setElementProperty($,kAnimationNamePropertyName,H),setElementProperty($,kAnimationDurationPropertyName,P)}}},cssPropertyValueForActionValue:function(e,t){switch(e){case"hidden":return t.scalar===!0?"hidden":"visible";case"anchorPoint":return t.pointX+"% "+t.pointY+"%";case"anchorPointZ":return t.scalar;case"position":return"translate("+t.pointX+"px,"+t.pointY+"px)";case"zPosition":return"translateZ("+t.scalar+"px)";case"translationEmphasis":return"translateX("+t.translationEmphasis[0]+"px) translateY("+t.translationEmphasis[1]+"px) translateZ("+t.translationEmphasis[2]+")";case"rotationEmphasis":return"rotateZ("+t.rotationEmphasis[6]+"rad)";case"scaleEmphasis":return"scale3d("+ensureScaleFactorNotZero(t.scaleEmphasis[3])+","+ensureScaleFactorNotZero(t.scaleEmphasis[4])+","+ensureScaleFactorNotZero(t.scaleEmphasis[5])+")";case"transform.scale":case"transform.scale.xy":return"scale("+ensureScaleFactorNotZero(t.scalar)+")";case"transform.scale.x":return"scaleX("+ensureScaleFactorNotZero(t.scalar)+")";case"transform.scale.y":return"scaleY("+ensureScaleFactorNotZero(t.scalar)+")";case"transform.rotation.x":return"rotateX("+t.scalar+"rad)";case"transform.rotation.y":return"rotateY("+t.scalar+"rad)";case"transform.rotation.z":case"transform.rotation":return"rotateZ("+t.scalar+"rad)";case"transform.translation":return"translateX("+t.pointX+"px) translateY("+t.pointY+"px)";case"transform.translation.x":return"translateX("+t.scalar+"px)";case"transform.translation.y":return"translateY("+t.scalar+"px)";case"transform.translation.z":return"translateZ("+t.scalar+"px)";case"isPlaying":case"opacity":case"opacityMultiplier":return t.scalar+"";case"transform":return"matrix3d("+t.transform+")";case"doubleSided":return t.scalar===!1?"hidden":"visible";default:return"some value"}},cssPropertyNameForAction:function(e){switch(e){case"hidden":return kVisibilityPropertyName;case"anchorPoint":return kTransformOriginPropertyName;case"anchorPointZ":return kTransformOriginZPropertyName;case"opacityMultiplier":return kOpacityPropertyName;case"translationEmphasis":case"rotationEmphasis":case"scaleEmphasis":case"position":case"zPosition":case"transform":case"transform.scale":case"transform.scale.xy":case"transform.scale.x":case"transform.scale.y":case"transform.rotation.x":case"transform.rotation.y":case"transform.rotation.z":case"transform.rotation":case"transform.translation":case"transform.translation.x":case"transform.translation.y":case"transform.translation.z":case"bounds":return kTransformPropertyName;case"doubleSided":return kBackfaceVisibilityPropertyName;case"contents":return kBackgroundImagePropertyName;default:return e}},handleMovieDidStart:function(e,t){t.style.visibility="visible"},handleMovieDidEnd:function(e,t){t.loop||(t.isEnded=!0)},startMovie:function(e){e&&(e.play(),e.isPlaying=!0)},stopMovie:function(e){e&&e.pause()}}),KPFLayer=Class.create({initialize:function(e,t,n){this.animationInfo=t,this.layerId=kpfLayerCounter,kpfLayerCounter+=1,this.objectID=e.objectID!=null?e.objectID:null,this.textureId=e.texture?e.texture:null,this.animations=e.animations,this.initialState=e.initialState,this.cssAnimationRules=[],this.layers=[],this.affineTransform=this.initialState.affineTransform,this.position=this.initialState.position,this.textureTransform="",this.initialState.transform!=null&&this.initialState.transform!=undefined?this.textureTransform="matrix3D("+this.initialState.transform+")":this.textureTransform="matrix("+this.affineTransform+")",this.anchorPoint=this.initialState.anchorPoint,n==null&&(n={pointX:0,pointY:0});var r=this.position.pointX-this.initialState.width/2-(this.anchorPoint.pointX-.5)*this.initialState.width,i=this.position.pointY-this.initialState.height/2-(this.anchorPoint.pointY-.5)*this.initialState.height;r=Math.round(r*1e6)/1e6,i=Math.round(i*1e6)/1e6,this.bounds={width:this.initialState.width,height:this.initialState.height,origin:{pointX:this.affineTransform[4],pointY:this.affineTransform[5]},offset:{pointX:r,pointY:i},canvasOffset:{pointX:r+n.pointX,pointY:i+n.pointY}},this.sublayerTransform=this.initialState.sublayerTransform,this.contentsRect=this.initialState.contentsRect,this.hidden=this.initialState.hidden,this.opacity=this.initialState.opacity,this.visibility=this.hidden===!0?"hidden":"visible",this.addSublayer(e.layers,t,this.bounds.offset),t.animationSupported&&this.initLayerAnimations()},destroy:function(){this.initialState=null,this.cssAnimationRules=null,this.affineTransform=null,this.textureTransform=null,this.anchorPoint=null,this.anchorPointZ=null,this.bounds=null,this.contentsRect=null,this.hidden=null,this.opacity=null},addSublayer:function(e,t,n){for(var r=0,i=e.length;r<i;r++){var s=new KPFLayer(e[r],t,n);this.layers.push(s)}},initLayerAnimations:function(){var e=!1,t=!1,n=!1,r=!1,i=!1,s=!1,o=!1,u=!1,a=!1,f=!1,l=!1,c=!1,h=!1,p=!1,d=!1,v=!1,m=!1,g=[],y=!1;this.animationInfo.type==="actionBuild"?this.isActionBuild=!0:this.animationInfo.type==="buildIn"?this.isBuildIn=!0:this.animationInfo.type==="buildOut"?this.isBuildOut=!0:this.animationInfo.type==="transition"&&(this.isTransition=!0,this.animationInfo.name==="apple:magic-move-implied-motion-path"?this.isMagicMove=!0:this.animationInfo.name==="apple:ca-isometric"&&(y=!0)),this.animations.length>0&&(this.cssAnimation=new KPFCssAnimation(this.animations,this));if(this.cssAnimation){this.divNames=[];var b={isPlaying:0,opacityMultiplier:1,hidden:2};for(var w in this.cssAnimation.keyAnimations)b.hasOwnProperty(w)||(w=="opacity"?t=!0:w==="anchorPoint"?n=!0:w==="anchorPointZ"?r=!0:!y&&w==="transform.translation.x"?i=!0:!y&&w==="transform.translation.y"?s=!0:!y&&w==="transform.translation.z"?o=!0:!y&&w==="transform.translation"?u=!0:!y&&w==="transform.rotation.x"?a=!0:!y&&w==="transform.rotation.y"?f=!0:!y&&w==="transform.rotation.z"?l=!0:!y&&w==="transform.rotation"?c=!0:w==="transform.scale.x"?h=!0:w==="transform.scale.y"?p=!0:w==="transform.scale.xy"?d=!0:w==="transform.scale"?v=!0:w==="transform"?m=!0:w==="doubleSided"?e=!0:w==="contents"?this.hasContentsAnimation=!0:w==="bounds"?this.hasBoundsAnimation=!0:w==="position"?this.hasPosition=!0:g.push(w));(t||this.isActionBuild)&&this.divNames.push("opacity"),m&&this.divNames.push("transform"),(this.hasPosition||this.isActionBuild)&&this.divNames.push("position"),n&&this.divNames.push("anchorPoint"),r&&this.divNames.push("anchorPointZ");for(var E=0,S=g.length;E<S;E++)this.divNames.push(g[E]);i&&this.divNames.push("transform.translation.x"),s&&this.divNames.push("transform.translation.y"),u&&this.divNames.push("transform.translation"),o&&this.divNames.push("transform.translation.z"),a&&this.divNames.push("transform.rotation.x"),f&&this.divNames.push("transform.rotation.y"),l&&this.divNames.push("transform.rotation.z"),(this.initialState.rotation!==0||this.isActionBuild)&&this.divNames.indexOf("transform.rotation.z")===-1&&this.divNames.push("transform.rotation.z"),c&&this.divNames.push("transform.rotation"),h&&this.divNames.push("transform.scale.x"),p&&this.divNames.push("transform.scale.y");if(this.initialState.scale!==1||this.isActionBuild)this.divNames.indexOf("transform.scale.x")===-1&&this.divNames.push("transform.scale.x"),this.divNames.indexOf("transform.scale.y")===-1&&this.divNames.push("transform.scale.y");d&&this.divNames.push("transform.scale.xy"),v&&this.divNames.push("transform.scale"),this.hasBoundsAnimation&&this.divNames.push("bounds"),e&&this.divNames.push("doubleSided")}}}),KPFCssAnimation=Class.create({initialize:function(e,t){this.kDelta=1e-4,this.kRoundingFactor=1e4,this.animations=[],this.keyAnimations={};for(var n=0,r=e.length;n<r;n++){var i=e[n],s=i.beginTime,o=i.duration,u=i.timingFunction?i.timingFunction:"linear",a,f,l,c,h,p=s+o;this.overallEndTime=0,p>this.overallEndTime&&(this.overallEndTime=p),u=="custom"&&(a=i.timingControlPoint1x,f=i.timingControlPoint1y,l=i.timingControlPoint2x,c=i.timingControlPoint2y);if(i.animations!=null&&i.animations.length>0){var d=i.animations,v=s;d[0].property==null&&(v=d[0].beginTime,d=d[0].animations);for(var m=0,g=d.length;m<g;m++){var y=d[m],b=y.property,w=this.keyAnimations[b];w==null&&(w={groupBeginTime:v,earliestBeginTime:v+y.beginTime,latestEndTime:-1,keyActions:[]},this.keyAnimations[b]=w),v+y.beginTime+y.duration>w.latestEndTime&&(w.latestEndTime=v+y.beginTime+y.duration);if(y.path){var E=i.path.length;for(var S=0;n<E;S++){var x=i.path[S],T=x.points[0],N,C;S===0?C={pointX:T[0],pointY:T[1]}:(N=i.path[S-1].points[0],C={pointX:N[0],pointY:N[1]});switch(x.type){case"MoveToPoint":case"AddLine":case"AddCurve":case"AddQuadCurve":h={property:"position",from:C,to:{pointX:T[0],pointY:T[1]},fillMode:"forwards",beginTime:v+y.beginTime+S/E*y.duration,duration:1/E*y.duration,timingFunction:"linear",groupTimingFunction:u,groupBeginTime:s,groupDuration:o,groupTimingControlPoint1x:a,groupTimingControlPoint1y:f,groupTimingControlPoint2x:l,groupTimingControlPoint2y:c}}this.addAction(h,y)}}else if(y.keyTimes){var k=y.keyTimes.length;for(var S=0;S<k-1;S++){var L=y.keyTimes[S],A=y.keyTimes[S+1];h={property:y.property,from:y.values[S],to:y.values[S+1],fillMode:y.fillMode,beginTime:v+y.beginTime+L/1*y.duration,duration:(A-L)*y.duration,timingFunction:y.timingFunctions?y.timingFunctions[S]:"linear",groupTimingFunction:u,groupBeginTime:s,groupDuration:o,groupTimingControlPoint1x:a,groupTimingControlPoint1y:f,groupTimingControlPoint2x:l,groupTimingControlPoint2y:c},this.addAction
(h,y)}}else h={property:y.property,from:y.from,to:y.to,fillMode:y.fillMode,beginTime:v+y.beginTime,duration:y.duration,timingFunction:y.timingFunction?y.timingFunction:"linear",groupTimingFunction:u,groupBeginTime:s,groupDuration:o,groupTimingControlPoint1x:a,groupTimingControlPoint1y:f,groupTimingControlPoint2x:l,groupTimingControlPoint2y:c},this.addAction(h,y)}}else{var b=i.property,w=this.keyAnimations[b];w==null&&(w={groupBeginTime:0,earliestBeginTime:i.beginTime,latestEndTime:-1,keyActions:[]},this.keyAnimations[b]=w),i.beginTime+i.duration>w.latestEndTime&&(w.latestEndTime=i.beginTime+i.duration);if(i.path){var E=i.path.length;for(var S=0;S<E;S++){var x=i.path[S],T=x.points[0],N,C;S===0?C={pointX:T[0],pointY:T[1]}:(N=i.path[S-1].points[0],C={pointX:N[0],pointY:N[1]});switch(x.type){case"MoveToPoint":case"AddLine":case"AddCurve":case"AddQuadCurve":h={property:"position",from:C,to:{pointX:T[0],pointY:T[1]},fillMode:"forwards",beginTime:s+S/E*o,duration:1/E*o,timingFunction:"linear"}}this.addAction(h,i)}}else if(i.keyTimes){var k=i.keyTimes.length;for(var S=0;S<k-1;S++){var L=i.keyTimes[S],A=i.keyTimes[S+1];h={property:i.property,from:i.values[S],to:i.values[S+1],fillMode:i.fillMode,beginTime:L/1*o,duration:(A-L)*o,timingFunction:i.timingFunctions?i.timingFunctions[S]:"linear"},this.addAction(h,i)}}else h={property:i.property,from:i.from,to:i.to,fillMode:i.fillMode,beginTime:s,duration:o,timingFunction:u?u:"linear"},this.addAction(h,i)}}this.createKeyActions(),this.createAnimationRules(t),this.createAnimationRuleForKeyframes(t)},addAction:function(e,t){t.timingFunction==="custom"?(e.timingControlPoint1x=t.timingControlPoint1x,e.timingControlPoint1y=t.timingControlPoint1y,e.timingControlPoint2x=t.timingControlPoint2x,e.timingControlPoint2y=t.timingControlPoint2y):e.timingFunction.timingFunction!=null&&(e.timingFunction.timingFunction==="custom"&&(e.timingControlPoint1x=e.timingFunction.timingControlPoint1x,e.timingControlPoint1y=e.timingFunction.timingControlPoint1y,e.timingControlPoint2x=e.timingFunction.timingControlPoint2x,e.timingControlPoint2y=e.timingFunction.timingControlPoint2y),e.timingFunction=e.timingFunction.timingFunction),this.animations.push(e)},createKeyActions:function(){for(var e=0,t=this.animations.length;e<t;e++){var n=this.animations[e],r=n.beginTime,i=n.duration,s=r+i,o=n.property,u=this.keyAnimations[o],a=u.keyActions,f=u.latestEndTime-u.earliestBeginTime,l=0,c=100;f>0&&(l=100*r/this.overallEndTime,c=100*s/this.overallEndTime),c>100&&(c=100);var h={startKeyframe:l,endKeyframe:c,from:n.from,to:n.to,timingFunction:n.timingFunction};n.fillMode&&(h.fillMode=n.fillMode),n.timingFunction=="custom"&&(h.timingControlPoint1x=n.timingControlPoint1x,h.timingControlPoint1y=n.timingControlPoint1y,h.timingControlPoint2x=n.timingControlPoint2x,h.timingControlPoint2y=n.timingControlPoint2y),a.push(h),a.sort(this.sortAction)}},sortAction:function(e,t){return e.startKeyframe-t.startKeyframe},roundNum:function(e){return Math.round(e*this.kRoundingFactor)/this.kRoundingFactor},createAnimationRules:function(e){var t=this.kDelta;for(var n in this.keyAnimations){if(n=="playing")continue;var r=this.keyAnimations[n],i=r.keyActions,s=!1;r.keyframes=[];var o=i[0],u=this.roundNum(o.startKeyframe),a=this.roundNum(100*r.groupBeginTime/this.overallEndTime);if(n=="anchorPoint"){var f={};f.x=o.to.pointX,f.y=o.to.pointY;var l=this.anchorPointOffset(e,f),c={pointX:l.x,pointY:l.y};if(e.isMagicMove){var h=this.anchorPointOffset(e,{x:o.from.pointX,y:o.from.pointY}),p={pointX:h.x,pointY:h.y},d=this.anchorPointOffset(e,{x:o.to.pointX,y:o.to.pointY}),v={pointX:d.x,pointY:d.y};if(p.pointX!==v.pointX||p.pointY!=v.pointY)c={pointX:v.pointX-p.pointX,pointY:v.pointY-p.pointY},e.magicMoveOffsetValue=c}if(u!=0){var m=this.createInitialKeyframeValue(e,n,o.from,!1);e.isMagicMove&&(m={pointX:0,pointY:0}),r.keyframes.push({keyframe:0,keyName:"position",value:m,timingFunction:"linear"}),r.keyframes.push({keyframe:u-t,keyName:"position",value:m,timingFunction:"linear"})}r.keyframes.push({keyframe:u,keyName:"position",value:c,timingFunction:"linear"}),r.keyframes.push({keyframe:100,keyName:"position",value:c,timingFunction:"linear"}),e.transformOriginValue=f.x*100+"% "+f.y*100+"%";continue}if(n=="anchorPointZ"){s=!0;if(u!=0){var m=this.createInitialKeyframeValue(e,n,o.from,!0);r.keyframes.push({keyframe:0,keyName:"zPosition",value:m,timingFunction:"linear"}),r.keyframes.push({keyframe:u-t,keyName:"zPosition",value:m,timingFunction:"linear"})}r.keyframes.push({keyframe:u,keyName:"zPosition",value:o.from,timingFunction:"linear"}),r.keyframes.push({keyframe:100,keyName:"zPosition",value:o.to,timingFunction:"linear"}),e.transformOriginZValue=o.to.scalar;continue}if(o==null)continue;var g=0,y=null,b=null;if(u!=0){if(n==="hidden")b={scalar:e.hidden},this.insertInitialKeyframes(r,u-t,n,b);else if(n==="opacity")o.fillMode==="both"||o.fillMode==="backwards"?b=o.from:b={scalar:e.opacity},this.insertInitialKeyframes(r,u-t,n,b);else if(n==="position")e.isBuildIn||e.isBuildOut?b={pointX:this.roundNum(o.from.pointX-e.initialState.position.pointX),pointY:this.roundNum(o.from.pointY-e.initialState.position.pointY)}:b={pointX:0,pointY:0},this.insertInitialKeyframes(r,u-t,n,b);else{b=this.createInitialKeyframeValue(e,n,o.from,s),a>0&&this.insertInitialKeyframes(r,a-t,n,b);if(u-a>t){if(o.fillMode==="both"||o.fillMode==="backwards")b=o.from;r.keyframes.push({keyframe:a,keyName:n,value:b,timingFunction:"linear"}),r.keyframes.push({keyframe:u-t,keyName:n,value:b,timingFunction:"linear"})}}g=o.startKeyframe,y=b}for(var w=0,E=i.length;w<E;w++){o=i[w],n=="position"&&(b=e.initialState.position,o.from={pointX:this.roundNum(o.from.pointX-b.pointX),pointY:this.roundNum(o.from.pointY-b.pointY)},o.to={pointX:this.roundNum(o.to.pointX-b.pointX),pointY:this.roundNum(o.to.pointY-b.pointY)}),Math.abs(o.startKeyframe-g)>t&&r.keyframes.push({keyframe:this.roundNum(o.startKeyframe)-t,keyName:n,value:y,timingFunction:"linear"});var S=this.createTimingFunctionForAction(o);r.keyframes.push({keyframe:this.roundNum(o.startKeyframe),keyName:n,value:o.from,timingFunction:S}),r.keyframes.push({keyframe:this.roundNum(o.endKeyframe)-(o.endKeyframe==100?0:t),keyName:n,value:o.to,timingFunction:S}),y=o.to,g=o.endKeyframe}g!=100&&n!="hidden"&&(r.keyframes.push({keyframe:this.roundNum(g),keyName:n,value:y,timingFunction:"linear"}),r.keyframes.push({keyframe:100,keyName:n,value:y,timingFunction:"linear"}))}},insertInitialKeyframes:function(e,t,n,r){e.keyframes.push({keyframe:0,keyName:n,value:r,timingFunction:"linear"}),e.keyframes.push({keyframe:t,keyName:n,value:r,timingFunction:"linear"})},anchorPointOffset:function(e,t){var n={},r={},i={},s=e.bounds;return n.x=s.width/2,n.y=s.height/2,r.x=t.x*s.width,r.y=t.y*s.height,i.x=n.x-r.x,i.y=n.y-r.y,i},createInitialKeyframeValue:function(e,t,n,r){var i={};switch(t){case"anchorPoint":i.pointX=(e.anchorPoint.pointX-.5)*e.bounds.width,i.pointY=(e.anchorPoint.pointY-.5)*e.bounds.height;break;case"anchorPointZ":Prototype.Browser.Gecko||Prototype.Browser.IE||isChrome||isIE?i.scalar=0:i.scalar=n.scalar+n.scalar;break;case"opacity":case"opacityMultiplier":i.scalar=e.opacity;break;case"hidden":i.scalar=e.hidden;break;case"position":i.pointX=e.affineTransform[4],i.pointY=e.affineTransform[5];break;case"zPosition":i.scalar=0;break;case"transform.scale":case"transform.scale.xy":case"transform.scale.x":case"transform.scale.y":i.scalar=e.initialState.scale;break;case"transform.rotation.z":i.scalar=e.initialState.rotation;case"transform":i.transform=n.transform;break;case"bounds":i.pointX=0,i.pointY=0,i.width=e.initialState.width,i.height=e.initialState.height;break;default:i.scalar=0,i.pointX=0,i.pointY=0}return i},createTimingFunctionForAction:function(e){var t="";switch(e.timingFunction){case"easeIn":t="ease-in";break;case"easeOut":t="ease-out";break;case"easeInOut":case"easeInEaseOut":t="ease-in-out";break;case"custom":t="cubic-bezier("+e.timingControlPoint1x+","+e.timingControlPoint1y+","+e.timingControlPoint2x+","+e.timingControlPoint2y+")";break;case"linear":t="linear";break;default:t="linear"}return t},createAnimationRuleForKeyframes:function(e){for(var t in this.keyAnimations){var n=this.keyAnimations[t],r="layer"+e.layerId+"-"+escapeTextureId(t),i,s="",o;if(t==="contents"){var u=this.roundNum(n.keyActions[0].startKeyframe);i=gShowController.animationManager.createAnimation(r+"-from");var a="0% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}",f="49.999% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}",l="50% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}",c="100% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}";u!==0&&(f=(100-u)/2+u-this.kDelta-this.kDelta+"% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}",l=(100-u)/2+u+"% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}"),i.insertRule?(i.insertRule(a),i.insertRule(f),i.insertRule(l),i.insertRule(c)):(i.appendRule(a),i.appendRule(f),i.appendRule(l),i.appendRule(c)),i=gShowController.animationManager.createAnimation(r+"-to"),a="0% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}",f="49.999% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}",l="50% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}",c="100% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}",u!==0&&(f=(100-u)/2+u-this.kDelta-this.kDelta+"% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}",l=(100-u)/2+u+"% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}"),i.insertRule?(i.insertRule(a),i.insertRule(f),i.insertRule(l),i.insertRule(c)):(i.appendRule(a),i.appendRule(f),i.appendRule(l),i.appendRule(c));continue}if(browserPrefix!="ms"){i=gShowController.animationManager.createAnimation(r);for(var h=0,p=n.keyframes.length;h<p;h++)o=n.keyframes[h],s=this.createAnimationRuleForKeyframe(t,o,e)+" ",i.insertRule?i.insertRule(s):i.appendRule(s);e.cssAnimationRules.push(r)}else if(browserVersion>=10){for(var h=0,p=n.keyframes.length;h<p;h++)o=n.keyframes[h],s+=this.createAnimationRuleForKeyframe(t,o,e)+" ";gShowController.animationManager.styleSheet.insertRule?gShowController.animationManager.styleSheet.insertRule(kKeyframesPropertyName+" "+r+" {"+s+"}",0):gShowController.animationManager.styleSheet.appendRule(kKeyframesPropertyName+" "+r+" {"+s+"}",0),e.cssAnimationRules.push(r)}}},createAnimationRuleForKeyframe:function(e,t,n){var r=t.keyframe,i=t.keyName,s=t.value,o=t.timingFunction,u,a=n.transformOriginValue,f=n.transformOriginZValue,l="";a&&(l=kTransformOriginPropertyName+": "+a+";");if(i=="hidden"){var c={scalar:-1};s.scalar==0?c.scalar=1:c.scalar=0,i="opacity",u=this.cssPropertyValueForActionValue(e,i,c)}else u=this.cssPropertyValueForActionValue(e,i,s);var h;h=this.cssPropertyNameForAction(i)+": "+u+"; "+(r<100?kAnimationTimingFunctionPropertyName+": "+o+";":"");var p=r+"% {"+l+h+"}";return p},cssPropertyValueForActionValue:function(e,t,n){switch(t){case"hidden":return n.scalar==1?"hidden":"visible";case"anchorPoint":return n.pointX+"% "+n.pointY+"%";case"anchorPointZ":return n.scalar;case"position":return"translate("+n.pointX+"px,"+n.pointY+"px)";case"zPosition":return e=="anchorPointZ"&&(Prototype.Browser.Gecko||navigator.userAgent.lastIndexOf("Chrome/")>0)?"translateZ("+ -n.scalar+"px)":"translateZ("+n.scalar+"px)";case"translationEmphasis":return"translateX("+n.translationEmphasis[0]+"px) translateY("+n.translationEmphasis[1]+"px) translateZ("+n.translationEmphasis[2]+")";case"rotationEmphasis":return"rotateZ("+n.rotationEmphasis[6]+"rad)";case"scaleEmphasis":return"scale3d("+ensureScaleFactorNotZero(n.scaleEmphasis[3])+","+ensureScaleFactorNotZero(n.scaleEmphasis[4])+","+ensureScaleFactorNotZero(n.scaleEmphasis[5])+")";case"transform.scale":case"transform.scale.xy":return"scale("+ensureScaleFactorNotZero(n.scalar)+")";case"transform.scale.x":return"scaleX("+ensureScaleFactorNotZero(n.scalar)+")";case"transform.scale.y":return"scaleY("+ensureScaleFactorNotZero(n.scalar)+")";case"transform.rotation.x":return"rotateX("+n.scalar+"rad)";case"transform.rotation.y":return"rotateY("+n.scalar+"rad)";case"transform.rotation.z":case"transform.rotation":return"rotateZ("+n.scalar+"rad)";case"transform.translation":return"translateX("+n.pointX+"px) translateY("+n.pointY+"px)";case"transform.translation.x":return"translateX("+n.scalar+"px)";case"transform.translation.y":return"translateY("+n.scalar+"px)";case"transform.translation.z":return"translateZ("+n.scalar+"px)";case"isPlaying":case"opacity":case"opacityMultiplier":return n.scalar+"";case"transform":return"matrix3d("+n.transform+")";case"doubleSided":return n.scalar==0?"hidden":"visible";case"contents":return n.texture;default:return"some value"}},cssPropertyNameForAction:function(e){switch(e){case"hidden":return kVisibilityPropertyName;case"anchorPoint":return kTransformOriginPropertyName;case"anchorPointZ":return kTransformOriginZPropertyName;case"opacityMultiplier":return kOpacityPropertyName;case"translationEmphasis":case"rotationEmphasis":case"scaleEmphasis":case"position":case"zPosition":case"transform":case"transform.scale":case"transform.scale.xy":case"transform.scale.x":case"transform.scale.y":case"transform.rotation.x":case"transform.rotation.y":case"transform.rotation.z":case"transform.rotation":case"transform.translation":case"transform.translation.x":case"transform.translation.y":case"transform.translation.z":case"bounds":return kTransformPropertyName;case"doubleSided":return kBackfaceVisibilityPropertyName;case"contents":return kBackgroundImagePropertyName;default:return e}}});