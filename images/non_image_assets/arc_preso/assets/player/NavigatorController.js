var NavigatorController=Class.create({initialize:function(e){this.domNode=e,this.thumbnailSidebar=new NavigatorThumbnailSidebar,this.thumbnailScroller=new NavigatorThumbnailScroller,this.thumbnailSelection=new NavigatorThumbnailSelection,this.thumbnailContainer=new NavigatorThumbnailContainer,this.thumbnailSidebar.domNode.appendChild(this.thumbnailScroller.domNode),this.thumbnailScroller.domNode.appendChild(this.thumbnailSelection.domNode),this.thumbnailScroller.domNode.appendChild(this.thumbnailContainer.domNode),this.domNode.appendChild(this.thumbnailSidebar.domNode),this.leftSidebar=new NavigatorLeftSidebar,this.domNode.appendChild(this.leftSidebar.domNode),Event.observe(this.domNode,"click",this.handleClickEvent.bind(this)),Event.observe(this.leftSidebar.domNode,"mouseover",this.handleMouseOverEvent.bind(this)),Event.observe(this.domNode,"mouseleave",this.handleMouseOutEvent.bind(this)),document.observe(kSlideIndexDidChangeEvent,this.handleSlideIndexDidChangeEvent.bind(this)),document.observe(kScriptDidDownloadEvent,this.handleScriptDidDownloadEvent.bind(this)),this.slideThumbnail=null},initScrollbar:function(){this.thumbnailScroller.domNode.scrollHeight>this.thumbnailScroller.domNode.offsetHeight?this.thumbnailScroller.domNode.style.width="126px":this.thumbnailScroller.domNode.style.width="129px",browserPrefix==="ms"&&(this.domNode.style.width="148px",this.thumbnailSidebar.domNode.style.left="-148px",this.thumbnailSidebar.domNode.style.width="137px",this.thumbnailScroller.domNode.style.width="137px")},handleClickEvent:function(e){if(gShowController.isRecording)return;e=e||window.event;var t=e.target||e.srcElement,n;browserPrefix==="ms"?e.cancelBubble=!0:e.stopPropagation();while(t.slideNumber==null&&t.nodeName.toLowerCase()!="body")t=t.parentNode;t.slideNumber&&(this.selectedSlideIndex=t.slideNumber,this.select(this.selectedSlideIndex))},select:function(e){gShowController.jumpToSlide(e)},handleMouseOverEvent:function(e){e=e||window.event;var t=0,n=0;if(e.pageX||e.pageY)t=e.pageX,n=e.pageY;else if(e.clientX||e.clientY)t=e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft,n=e.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop;if(t===0&&n===0)return;var r=this.selectedSlideIndex*76,i=this.thumbnailScroller.domNode.scrollTop,s=this.thumbnailScroller.domNode.clientHeight;if(i>r)this.thumbnailScroller.domNode.scrollTop=r;else if(i+s<r+76){var o=r-i-s+76;this.thumbnailScroller.domNode.scrollTop=this.thumbnailScroller.domNode.scrollTop+o}clearTimeout(this.navigatorTimeout),this.navigatorTimeout=setTimeout(this.thumbnailSidebar.show.bind(this.thumbnailSidebar,this.leftSidebar),400)},handleMouseOutEvent:function(e){clearTimeout(this.navigatorTimeout),this.navigatorTimeout=setTimeout(this.thumbnailSidebar.hide.bind(this.thumbnailSidebar,this.leftSidebar),400)},handleSlideIndexDidChangeEvent:function(e){this.selectedSlideIndex=e.memo.slideIndex,this.thumbnailSelection.select(this.selectedSlideIndex)},handleScriptDidDownloadEvent:function(e){var t=e.memo.script;for(var n=0,r=t.slideList.length;n<r;n++){var i=t.slideList[n],s=new NavigatorThumbnailItem;s.domNode.slideNumber=n+1,s.numberNode.innerHTML=n+1,setElementProperty(s.domNode,"top",n*76+"px"),this.thumbnailContainer.addItem(s);if(gShowController.delegate.getKPFJsonStringForShow==null){var o="../"+i+"/thumbnail.jpeg",u=document.createElement("img");Event.observe(u,"load",this.updateThumbnail.bind(this,n,u)),u.src=o}else gShowController.delegate.loadTextureBySlideIndex(n,{type:"slideThumbnail",state:"outgoing"},function(e,t){this.updateThumbnail(e,t)}.bind(this,n))}this.initScrollbar()},updateThumbnail:function(e,t){var n=this.thumbnailContainer.thumbnailItems[e].canvasContainer;if(this.slideThumbnail==null){var r=gShowController.script.originalSlideWidth,i=gShowController.script.originalSlideHeight,s=r/i,o,u;s>=4/3?(o=88,u=Math.ceil(88*(1/s))):(o=Math.ceil(66*s),u=66),this.slideThumbnail={width:o,height:u,top:Math.ceil((66-u)/2),left:Math.ceil((88-o)/2),scaleX:o/r,scaleY:u/i}}t.nodeName.toLowerCase()==="svg"&&t.firstElementChild.setAttribute("transform","matrix("+this.slideThumbnail.scaleX+",0,0,"+this.slideThumbnail.scaleY+",0,0)"),t.setAttribute("style",kTransitionPropertyName+":opacity; "+kTransitionDurationName+":500; width:"+this.slideThumbnail.width+"px; height:"+this.slideThumbnail.height+"px; left:"+this.slideThumbnail.left+"px; top:"+this.slideThumbnail.top+"px; opacity: 0; position: absolute;"),t.setAttribute("draggable",!1),browserPrefix==="moz"&&Event.observe(t,"dragstart",function(e){e.preventDefault()}),n.appendChild(t),t.style.opacity=1}}),NavigatorLeftSidebar=Class.create({initialize:function(){this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorLeftSidebar")}}),NavigatorThumbnailSidebar=Class.create({initialize:function(){this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorThumbnailSidebar")},show:function(e){e.domNode.style.visibility="hidden",this.domNode.style.left="0px",gShowController.displayManager.navigatorIsShowing=!0,gShowController.displayManager.clearTimeoutForCursor()},hide:function(e){e.domNode.style.visibility="visible",this.domNode.style.left="-140px",gShowController.displayManager.navigatorIsShowing=!1,gShowController.displayManager.setTimeoutForCursor()}}),NavigatorThumbnailScroller=Class.create({initialize:function(){this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorThumbnailScroller")}}),NavigatorThumbnailSelection=Class.create({initialize:function(e){this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorThumbnailSelection")},select:function(e){this.domNode.style.top=76*e+"px",this.domNode.style.display="block"}}),NavigatorThumbnailContainer=Class.create({initialize:function(){this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorThumbnailContainer"),this.thumbnailItems=[]},addItem:function(e){this.thumbnailItems.push(e),this.domNode.appendChild(e.domNode)}}),NavigatorThumbnailItem=Class.create({initialize:function(){this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorThumbnailItem"),this.thumbnailContentNode=document.createElement("div"),this.thumbnailContentNode.setAttribute("style","position: absolute; height: 76px; width: 119px;"),this.numberNode=document.createElement("div"),this.numberNode.setAttribute("style","position: absolute; bottom: 1px; width: 20px; height: 20px; text-align: right; font-weight: bold; color: white;"),this.imageNode=document.createElement("div"),this.imageNode.setAttribute("style","position: absolute; left: 24px; width: 95px; height: 76px;"),this.thumb=document.createElement("div"),this.thumb.setAttribute("style","position: absolute; top: 4px; width: 90px; height: 68px;"),this.canvasContainer=document.createElement("div"),this.canvasContainer.setAttribute("class","navigatorThumbnailItemCanvasContainer"),this.thumb.appendChild(this.canvasContainer),this.imageNode.appendChild(this.thumb),this.thumbnailContentNode.appendChild(this.numberNode),this.thumbnailContentNode.appendChild(this.imageNode),this.domNode.appendChild(this.thumbnailContentNode)}});