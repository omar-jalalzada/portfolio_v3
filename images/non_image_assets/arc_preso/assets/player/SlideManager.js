var SlideManager=Class.create({initialize:function(e){this.header=e.header,this.slides={};for(var t=0,n=this.header.slideList.length;t<n;t++)this.slides[this.header.slideList[t]]={downloaded:!1,script:{},retry:0}},getSlides:function(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];this.slides[i].downloaded=!0,this.slides[i].script=JSON.parse(t.getKPFJsonStringForSlideIndex(n)),this.slides[i].originalScript=JSON.parse(t.getKPFJsonStringForSlideIndex(n)),document.fire(kSlideDidDownloadEvent,{id:i})}},downloadSlides:function(e){for(var t=0,n=e.length;t<n;t++)this.downloadSlide(e[t])},downloadSlide:function(e){var t="../"+e+"/"+e+".json";if(window.location.protocol==="file:"){t+="p";if(window.local_slide==null||window.local_slide==undefined)window.local_slide=function(e){this.slideDidDownload(null,e,!0)}.bind(this);var n=document.createElement("script");n.setAttribute("src",t),document.head.appendChild(n)}else new Ajax.Request(t,{method:"get",onSuccess:this.slideDidDownload.bind(this,e),onFailure:this.slideDidNotDownload.bind(this,e)})},slideDidDownload:function(e,t,n){n?(e=t.name,this.slides[e].script=t.json,this.slides[e].originalScript=JSON.parse(JSON.stringify(t.json))):(this.slides[e].script=JSON.parse(t.responseText),this.slides[e].originalScript=JSON.parse(t.responseText)),this.slides[e].downloaded=!0,document.fire(kSlideDidDownloadEvent,{id:e})},slideDidNotDownload:function(){var e=arguments[0];arguments[1].status!=200&&(this.slides[e].retry<1?(this.downloadSlide(e),this.slides[e].retry++):document.fire(kSlideDidNotDownloadEvent,{id:e}))}});