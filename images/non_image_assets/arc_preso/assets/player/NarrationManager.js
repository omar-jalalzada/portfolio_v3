var NarrationManager=Class.create({initialize:function(e){this.movieSegments=e.movieSegments,this.duration=e.duration,this.eventTracks=e.eventTracks,this.currentNavigationEventIndex=0,this.lastSceneIndex=0;for(var t=0,n=this.eventTracks.length;t<n;t++){var r=this.eventTracks[t];r.type==="navigation"?this.navigationEvents=r.events:r.type==="movie"?this.movieEvents=r.events:r.type==="pause"&&(this.pauseEvents=r.events)}},start:function(){var e=new Audio;e.src="../"+this.movieSegments[0].url,Event.observe(e,"playing",this.handleAudioDidStart.bind(this)),Event.observe(e,"ended",this.handleAudioDidEnd.bind(this,0)),e.play()},handleAudioDidStart:function(){setTimeout(this.navigate(this.navigationEvents[0],!0),100)},handleAudioDidEnd:function(e){var t=e+1;if(this.movieSegments[t]){var n=new Audio;n.src="../"+this.movieSegments[t].url,n.play(),Event.stopObserving(n,"ended"),Event.observe(n,"ended",this.handleAudioDidEnd.bind(this,t))}},navigate:function(e,t){var n=this.sceneIndexFromNavigationEvent(e);if(e.animationPhase==="start"){var r=!1;gShowController.script.loopSlideshow?this.lastSceneIndex===gShowController.script.numScenes-1&&n===0&&(r=!0):this.lastSceneIndex+1===n&&(r=!0);if(r)gShowController.state===kShowControllerState_IdleAtInitialState?gShowController.playCurrentScene():gShowController.state===kShowControllerState_IdleAtFinalState&&gShowController.jumpToScene(this.lastSceneIndex,!0);else{var i=gShowController.scriptManager.slideIndexFromSceneIndex(n),s=this.lastSceneIndex,o=gShowController.script.events[s].hyperlinks,u,a;for(var f=0,l=o.length;f<l;f++){u=o[f],a=u.events[e.slide];if(a)break}u?gShowController.jumpToHyperlinkSlide(i,u):gShowController.jumpToScene(n,!1)}}else e.animationPhase==="none"&&t==null&&gShowController.jumpToScene(n,!1);var c=this.navigationEvents[this.currentNavigationEventIndex+1];if(c==null)return;var h=c.startTime-e.startTime;setTimeout(this.navigate.bind(this,c),h*1e3),this.lastSceneIndex=n,this.currentNavigationEventIndex=this.currentNavigationEventIndex+1},handleCurrentSceneDidComplete:function(e){gShowController.jumpToScene(e,!1)},sceneIndexFromNavigationEvent:function(e){var t=e.slide,n=gShowController.script.slideList,r=-1;for(var i=0,s=n.length;i<s;i++)if(n[i]===t){r=i;break}var o=gShowController.scriptManager.sceneIndexFromSlideIndex(r),u=e.eventIndex+o;return u},slideIndexFromSlideId:function(e){var t=gShowController.slideList,n=-1;for(var r=0,i=t.length;r<i;r++)if(t[r]===e){n=r;break}return n}});